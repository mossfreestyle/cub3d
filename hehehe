# TODO Cub3D - Suivi de la progression dÃ©taillÃ©

---

## ğŸŸ¢ PARSING

### âœ… DÃ©jÃ  fait
- âœ… Lecture du fichier map avec GNL
- âœ… Parsing des textures et couleurs (NO, SO, WE, EA, F, C)
- âœ… VÃ©rification de l'unicitÃ© des textures et couleurs
- âœ… VÃ©rification de l'extension `.xpm` pour les textures
- âœ… VÃ©rification de l'extension `.cub` pour le fichier map
- âœ… VÃ©rification que la map est le dernier Ã©lÃ©ment du fichier
- âœ… **Gestion des lignes vides dans la map** (dÃ©tection et erreur)
- âœ… VÃ©rification du nombre de joueurs (exactement 1)
- âœ… RÃ©cupÃ©ration de la position et de la direction du joueur
- âœ… VÃ©rification des caractÃ¨res valides dans la map
- âœ… Remplissage des espaces vides par un caractÃ¨re spÃ©cifique (`X`)
- âœ… VÃ©rification que la map est bien fermÃ©e par des murs (`check_is_closed`)
- âœ… Gestion des erreurs et libÃ©ration mÃ©moire
- âœ… VÃ©rification des valeurs RGB (0-255)
- âœ… VÃ©rification du format RGB (3 valeurs sÃ©parÃ©es par des virgules)
- âœ… **Correction du bug 'W' vs 'O' dans `get_nb_players`**
- âœ… **Correction de l'allocation mÃ©moire dans `set_up_final_map`**
- âœ… **Correction des boucles dans `check_is_closed`**
- âœ… **Correction de `recup_gnl` pour Ã©viter les memory leaks**
- âœ… **Gestion des tabulations dans le parsing**
- âœ… **Correction des espaces dans les valeurs RGB**
- âœ… **Correction du buffer overflow dans `set_up_final_map`**
- âœ… **Correction des pointeurs non initialisÃ©s avec `calloc`**
- âœ… **DÃ©tection des lignes vides au milieu de la map**
- âœ… **VÃ©rification de l'existence des fichiers de textures**

### ğŸŸ¡ Ã€ faire / Ã€ amÃ©liorer

#### ğŸ”¸ Robustesse parsing
- [ ] **VÃ©rifier que le joueur n'est pas sur un bord de la map**  
  â†’ Le joueur ne doit jamais Ãªtre placÃ© sur la premiÃ¨re/derniÃ¨re ligne ou colonne.
- [ ] **VÃ©rifier que le joueur ne touche pas un espace ou un bord**  
  â†’ Les cases autour du joueur doivent Ãªtre des murs ou des cases valides.
- [ ] **GÃ©rer les cas limites**  
  â†’ Map non rectangulaire, lignes trÃ¨s longues, caractÃ¨res inattendus, plusieurs blocs de map, etc.
- [ ] **Ajouter des messages d'erreur plus prÃ©cis**  
  â†’ Indiquer la ligne et la nature exacte de l'erreur.
- [ ] **Tester avec tous les maps de test**  
  â†’ Valider le parsing avec les maps `bad/`, `invalid/`, `valid/`, etc.
- [ ] **Nettoyer et commenter le code pour la relecture finale**

#### ğŸ”¸ Bonus parsing (optionnel)
- [ ] **Supporter les maps avec plusieurs blocs sÃ©parÃ©s par des lignes vides**  
  â†’ S'assurer que seul le bloc contenant le joueur est gardÃ©.
- [ ] **VÃ©rifier que la map ne contient pas de caractÃ¨res interdits mÃªme dans les lignes vides**

---

## ğŸŸ¦ EXECUTION / RAYCASTING

### âœ… DÃ©jÃ  fait
- âœ… Initialisation des structures player, map, assets, key
- âœ… Hooks clavier de base (WASD, ESC)
- âœ… DÃ©but du raycasting (fonction DDA prÃ©sente)
- âœ… Structures de donnÃ©es pour le raycasting
- âœ… **Initialisation MLX fonctionnelle**
- âœ… **Gestion des Ã©vÃ©nements clavier**
- âœ… **Fermeture propre de la fenÃªtre**

### ğŸŸ¡ Ã€ faire / Ã€ amÃ©liorer

#### ğŸ”¸ Affichage et moteur
- [ ] **Affichage des murs avec textures**  
  â†’ Charger les fichiers `.xpm` avec `mlx_xpm_file_to_image()`, appliquer la texture sur les murs selon la direction du rayon.
- [ ] **Affichage du sol et du plafond**  
  â†’ Colorier les pixels du sol et du plafond selon la couleur dÃ©finie dans la map.
- [ ] **ImplÃ©mentation du raycasting complet**  
  â†’ Algorithme DDA, calcul des distances, projection des murs.
- [ ] **Gestion correcte des collisions avec les murs et les espaces vides**  
  â†’ EmpÃªcher le joueur de traverser les murs ou les cases remplies (`X`).
- [ ] **Gestion de la rotation du joueur (gauche/droite)**  
  â†’ Modifier l'angle de vue avec les touches flÃ©chÃ©es ou la souris.
- [ ] **Gestion des angles et du FOV**  
  â†’ S'assurer que le rendu respecte bien le champ de vision.
- [ ] **Optimisation du raycasting**  
  â†’ Correction du fish-eye, gestion des distances, optimisation des calculs.
- [ ] **Gestion des erreurs lors du chargement des textures**  
  â†’ VÃ©rifier que `mlx_xpm_file_to_image()` rÃ©ussit.

#### ğŸ”¸ Bonus exÃ©cution (optionnel)
- [ ] **Effets visuels (shading, animation, etc.)**
- [ ] **Affichage d'un HUD minimal**

---

## â­ï¸ BONUS

### ğŸŸ¡ Ã€ faire

#### ğŸ”¸ Mini-map
- [ ] **Affichage d'une mini-map Ã  l'Ã©cran**  
  â†’ Vue du dessus, position du joueur, murs, direction du regard.

#### ğŸ”¸ Collisions avancÃ©es
- [ ] **Collision prÃ©cise avec les murs**  
  â†’ EmpÃªcher le joueur de traverser les murs mÃªme en diagonale ou en glissant sur les bords.

#### ğŸ”¸ Mouvement de la souris
- [ ] **Gestion du mouvement de la souris pour tourner la vue**  
  â†’ Capter les mouvements horizontaux de la souris pour faire tourner la camÃ©ra.

#### ğŸ”¸ (Optionnel)
- [ ] **Portes, objets interactifs, HUD avancÃ©, sons, etc.**

---

## ğŸ”§ BUGS CORRIGÃ‰S

### âœ… RÃ©cemment corrigÃ©s
- âœ… **Bug 'W' vs 'O' dans `get_nb_players`** - Correction de la comparaison de caractÃ¨res
- âœ… **Allocation incorrecte dans `set_up_final_map`** - Correction de l'allocation mÃ©moire
- âœ… **Segfault dans `check_is_closed`** - Correction des boucles et vÃ©rifications
- âœ… **Memory leak dans `recup_gnl`** - Correction du double free avec `ft_strjoin`
- âœ… **VÃ©rification extension `.cub`** - Correction de la vÃ©rification du nom de fichier
- âœ… **Double tours dans `is_valid`** - Correction de la logique de validation
- âœ… **Padding avec 'X' au lieu d'espaces** - Correction du remplissage de la map
- âœ… **Gestion des tabulations** - Acceptation des `\t` dans `recup_gnl`
- âœ… **Espaces dans RGB** - Correction de `||` en `&&` dans `put_color`
- âœ… **Buffer overflow dans `set_up_final_map`** - SÃ©paration des variables de boucle
- âœ… **Pointeurs non initialisÃ©s** - Utilisation de `calloc` au lieu de `malloc`
- âœ… **Lignes vides dans la map** - DÃ©tection et erreur pour `trash_in_map6.cub`
- âœ… **Invalid read dans `check_valid_path`** - VÃ©rification de la longueur avant accÃ¨s
- âœ… **MLX memory leak** - Ajout de `mlx_destroy_display` et `free`

---

## ğŸ“ RÃ©capitulatif progression

- **Parsing** : **95%** âœ…  
  (parsing trÃ¨s robuste, memory leaks corrigÃ©s, dÃ©tection des erreurs complÃ¨te)
- **Raycasting/exÃ©cution** : **20%** ğŸŸ¡  
  (structures prÃªtes, MLX initialisÃ©, reste l'affichage et la game loop)
- **Bonus** : **0%** ğŸ”´  
  (Ã  commencer aprÃ¨s le core)

---

## ğŸ¯ **Prochaines Ã©tapes prioritaires**

1. **Finaliser les tests de parsing** avec toutes les maps restantes
2. **Charger les textures** avec `mlx_xpm_file_to_image()` et gestion d'erreurs
3. **ImplÃ©menter le raycasting de base** - algorithme DDA
4. **Afficher les murs texturÃ©s** selon la direction du rayon
5. **Ajouter l'affichage du sol et plafond** avec les couleurs RGB
6. **ImplÃ©menter les collisions** et le mouvement fluide du joueur
7. **Ajouter la rotation** avec les flÃ¨ches ou la souris

---

## ğŸ§ª TESTS Ã€ FAIRE

### Maps Ã  tester :
- âœ… `maps/maps/invalid/trash_in_map6.cub` - RejetÃ©e (lignes vides)
- âœ… `maps/maps/invalid/trash_in_map7.cub` - RejetÃ©e (lignes vides)
- âœ… `maps/maps/valid/default.cub` - AcceptÃ©e (tabulations)
- [ ] `maps/maps/bad/` - Toutes les maps invalides
- [ ] `maps/maps/invalid/` - Maps avec erreurs diverses restantes
- [ ] `maps/maps/valid/` - Maps valides restantes
- [ ] `maps/maps/perso/` - Maps personnalisÃ©es

### Cas limites :
- âœ… Fichiers avec tabulations
- âœ… Lignes vides dans la map
- âœ… Espaces dans les valeurs RGB
- âœ… Chemins de textures trop courts
- [ ] Fichiers inexistants
- [ ] Permissions insuffisantes  
- [ ] Maps trÃ¨s grandes
- [ ] Textures inexistantes
- [ ] Valeurs RGB limites (0, 255)
- [ ] Double virgules dans RGB
- [ ] CaractÃ¨res spÃ©ciaux

---

## ğŸš€ **Ã‰TAT ACTUEL**

**Parsing quasi terminÃ© et trÃ¨s robuste !** 
- Memory leaks corrigÃ©s
- DÃ©tection d'erreurs complÃ¨te
- Gestion des cas limites
- Validation stricte des formats

**PrÃªt Ã  passer au raycasting et Ã  l'affichage ! ğŸ®**

---

**Prochaine Ã©tape : ImplÃ©menter le moteur de rendu 3D ! ğŸš€**